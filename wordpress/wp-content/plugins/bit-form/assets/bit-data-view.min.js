var bit_data_view=function(){"use strict";class t{#t={};#e=null;#s=null;#i=null;#a=null;#n=null;#l=null;#r=null;#o=[];#h=0;#c=10;#d=null;#u=null;#b=10;#g=1;#f=null;#p=null;#m=null;#w={};#I=[];#P={};#v=null;#E=null;#S=null;#y=null;#C={};#$={};#_=[];#B=null;constructor(t,e){Object.assign(this.#t,e),this.#e=e?.document||document,this.#s=e?.window||window,this.#p=e.formId,this.#m=e.viewId,this.#w=e.tableConfig,this.#I=e.tableConfig.columnsMap,this.#P=e.tableConfig.actionsBtn,this.#d=e.totalRecords,this.#$=e.accessControl,this.#_=e?.formFields,this.#r="string"==typeof t?this.#e.querySelector(t):t,this.#v=this.#s.bf_view_globals.entries,this.#C=this.#s.bf_view_globals.userInfo,this.#B=this.#s.bf_view_globals.uploadUrl,this.init()}init(){this.#T(),this.#O(),this.#L(),this.#M(),this.#c=Math.ceil(this.#d/this.#b),this.#y.innerHTML=this.#c,this.#k()}#k(){this.#l[0].disabled=0===this.#h,this.#l[1].disabled=0===this.#h,this.#l[2].disabled=this.#h===this.#c-1,this.#l[3].disabled=this.#h===this.#c-1}#T(){this.#l=this.#r.querySelectorAll(`.bf${this.#p}-${this.#m}-pgn-btn`),this.#u=this.#F(`.bf${this.#p}-${this.#m}-tbl-pgn-slt`),this.#n=this.#F(`.bf${this.#p}-${this.#m}-tbody`),this.#E=this.#F(`.bf${this.#p}-${this.#m}-serc-bx`),this.#S=this.#F(`.bf${this.#p}-${this.#m}-curr-page`),this.#y=this.#F(`.bf${this.#p}-${this.#m}-total-page`)}clear(){this.#r.innerHTML="",this.#H()}#H(){this.#o.forEach((({selector:t,eventType:e,cb:s})=>{t.removeEventListener(e,s)}))}#N(t,e,s){t.addEventListener(e,s),this.#o.push({selector:t,eventType:e,cb:s})}#F(t){return this.#r.querySelector(t)}#L(){this.#N(this.#u,"change",(t=>{t.preventDefault();const e=t.target.value;this.#b=parseInt(e,10),this.#c=Math.ceil(this.#d/this.#b),this.#y.innerHTML=this.#c,this.#k(),this.#S.innerHTML=1,this.#D()}))}#O(){this.#l.forEach((t=>{this.#N(t,"click",(t=>{switch(t.preventDefault(),t.target.dataset.page){case"start":this.#h=0;break;case"end":this.#h=this.#c-1;break;case"previous":this.#h>=1&&(this.#h-=1);break;case"next":this.#h<this.#c&&(this.#h+=1)}this.#k(),this.#S.innerHTML=this.#h+1,this.#D()}))}))}debounce(t,e,s){let i;return function(){const a=this,n=arguments,l=s&&!i;clearTimeout(i),i=setTimeout((function(){i=null,s||t.apply(a,n)}),e),l&&t.apply(a,n)}}#M(){this.#N(this.#E,"keyup",this.debounce((t=>{let e;e=t.target.value?this.#z(t.target.value):this.#v,this.#j(e)}),500))}#z(t){const e=t.toLowerCase(),s={};return Object.keys(this.#v).forEach((t=>{const i=this.#v[t];for(const a in i)i[a].toLowerCase().includes(e)&&(s[t]=i)})),s}#A(){const{accessFor:t,all:e}=this.#$,{roles:s}=this.#C;return!("all"!==t||!e.entryEdit.includes(s[0]))}#U(){const{accessFor:t,user:e}=this.#$,{id:s}=this.#C;return!("user"!==t||!e.ids.includes(s))}#W(t){const e=this.#R("td"),s=this.#R("div"),i=this.#P.editButton,a=this.#P.viewButton,{accessFor:n,all:l}=this.#$,{roles:r}=this.#C;if(this.#x(s,`bf${this.#p}-${this.#m}-tbl-action-btns`),i.show&&"all"===n&&l.entryEdit.includes(r[0])){const e=this.#R("a");e.innerHTML=i.btnTxt,this.#x(e,`bf${this.#p}-${this.#m}-tbl-edit-btn`),e.href=`${i.slug}?bf_entry_id=${t}`,this.#J(s,e)}if(a.show&&"all"===n&&l.singleEntryDetailsView.includes(r[0])){const e=this.#R("a");e.innerHTML=a.btnTxt,this.#x(e,`bf${this.#p}-${this.#m}-tbl-view-btn`),e.href=`${a.slug}?bf_entry_id=${t}`,this.#J(s,e)}return this.#J(e,s),e}#D(){let t=0;0!==this.#h&&(t=this.#h*this.#b),async function(t,e,s=null,i=null){if(!bf_view_globals)return!1;const a=new URL(bf_view_globals?.ajaxURL);if(a.searchParams.append("action",e),i)for(const t in i)t&&a.searchParams.append(t,i[t]);return await fetch(a,{method:"POST",headers:{"Content-Type":null===s?"application/x-www-form-urlencoded":s},body:t instanceof FormData?t:JSON.stringify(t)}).then((t=>t.json()))}({formId:this.#p,tableId:this.#m,offset:t,pageSize:this.#b},"bitforms_get_entries").then((t=>{const{data:e}=t,s=Object.keys(e).sort(((t,e)=>e-t)),i={};s.forEach((t=>{i[t]=e[t]})),this.#v=i,this.#j(this.#v)}))}#q(t,e,s,i,a){const n=`${this.#B}/${this.#p}/${s}/${t}`,l=this.#R("img");return l.src=n,l.alt=e,void 0!==i&&(l.style.width=i),void 0!==a&&(l.style.height=a),l}#V(t){return t in this.#_&&["advanced-file-up","signature","file-up"].includes(this.#_[t].typ)}#j(t){this.#n.innerHTML="";const{head:e}=this.#w.actionsBtn;Object.keys(t).forEach((s=>{const i=this.#R("tr");if(this.#I.forEach((e=>{const a=this.#R("td"),n=e.fk.replace(/\${([a-zA-Z0-9]+-\d+)}/g,"$1");if(this.#V(n)){const i=t[s][e.fk],n=this.#Z(i)&&JSON.parse(i);if(Array.isArray(n))n.forEach((t=>{const e=this.#q(t,t,s,"100%");this.#J(a,e)}));else{const t=this.#q(i,i,s,"100%");this.#J(a,t)}}else a.innerHTML=t[s][e.fk];this.#J(i,a)})),e?.show&&(this.#A()||this.#U())){const t=this.#W(s);this.#J(i,t)}this.#J(this.#n,i)}))}#Z(t){try{JSON.parse(t)}catch(t){return!1}return!0}#R(t){return this.#e.createElement(t)}#x(t,e){t.classList.add(e)}#J(t,e){t.appendChild(e)}}return document.addEventListener("DOMContentLoaded",(()=>{void 0!==bit_data_view&&bit_data_view()})),function(){Object.keys(window?.bf_view_globals.bf_tables||{}).forEach((e=>{const s=window.bf_view_globals.bf_tables[e];if(s){const{formId:e,viewId:a}=s,n=(i=`.bf${e}-${a}-tbl-wrp`,document.querySelector(i));s.inits=new t(n,s)}var i}))}}();
