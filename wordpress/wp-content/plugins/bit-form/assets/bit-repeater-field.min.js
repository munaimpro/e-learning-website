var bit_repeater_field=function(){"use strict";return class{#t;#e;#i;#s;#n;#d=[];#r;#a;#o;#l;#h;#c;#u;#m;#p;#f;#w;#b=1;#y=[];#x=[];#g=!1;#A=["select","country","currency","phone-number","file-up"];constructor(t,e){this.#v(e),this.#t="string"==typeof t?this.#n.querySelector(t):t,this.init()}#v(t){this.#s=t.window||window,this.#n=t.document||document,this.#r=t.fieldKey,this.#a=t.fieldName,this.#o=t.contentId,this.#l=t.defaultRow,this.#c=t.minimumRow,this.#u=t.maximumRow,this.#m=t.showAddBtn,this.#p=t.showAddToEndBtn,this.#h=t.defaultValue}init(){if(this.#u>0&&this.#u<this.#l&&(this.#l=this.#u),this.#c>0&&this.#c>this.#l&&(this.#l=this.#c),this.#u>0&&this.#u<this.#c&&(this.#c=this.#u),this.#c<1&&(this.#c=1),this.#e=this.#E(this.#R(`.${this.#r}-rpt-wrp`)),this.#i=this.#R(`[name='${this.#a}-repeat-index']`),this.#$(),this.#I(`.${this.#r}-rpt-wrp`).forEach((t=>{this.#T(t,this.#b),this.#F(this.#b),this.#N(this.#b),this.#B(this.#b),this.#b+=1})),this.#p){this.#f=this.#R(`.${this.#r}-add-to-end-btn-wrp`),this.#w=this.#R(`.${this.#r}-add-to-end-btn`),this.#C(this.#w,"click",(t=>this.#S(t)));const t=this.#s.bf_globals[this.#o];t?.onfieldCondition&&this.#C(this.#w,"click",(t=>{setTimeout((()=>{bit_conditionals({target:this.#w})&&t.stopPropagation()}),0)}))}this.#k(),this.#h&&(this.value=this.#h)}#$(){const t=bf_globals[this.#o],e=[],i=[],s=[];this.#I("input[name],select[name],textarea[name]",this.#e).forEach((t=>{const i=t.getAttribute("name");e.push(i.replace("[]",""))}));const{fields:n}=t;new Set(e).forEach((t=>{Object.entries(n).forEach((([e,n])=>{n.fieldName===t&&(s.push(e),-1!==this.#A.indexOf(n.typ)&&i.push({key:e,name:t,type:n.typ}))}))})),t.repeatFields||(t.repeatFields={}),t.repeatFields={...t.repeatFields,[this.#r]:s},this.#x=i}#N(t){t>1&&this.#x.forEach((e=>{bf_globals[this.#o].inits[`${e.key}[${t}]`]=this.#s.getFldInstance(this.#o,e.key,e.type,`.rpt-index-${t} `)}))}#B(t){"undefined"!=typeof initCheckDisableOnMax&&initCheckDisableOnMax(this.#o,`.rpt-index-${t} `)}#K(t){this.#x.forEach((e=>{delete bf_globals[this.#o].inits[`${e.key}[${t}]`]}))}#T(t,e){const i=t,s=this.#I("input[name],select[name],textarea[name]",i),n=this.#I("button[data-parent-field-name]",i),d=this.#s.bf_globals[this.#o];if(i.classList.add(`rpt-index-${e}`),i.dataset.index=e,this.#W(i,!0),s.forEach((t=>{const i=t.getAttribute("id");i&&t.setAttribute("id",`${i}-rpt-${e}`);const s=t.getAttribute("name");-1!==s.indexOf("[]")?t.setAttribute("name",s.replace("[]",`[${e}][]`)):t.setAttribute("name",`${s}[${e}]`);const n=["checkbox","radio"].includes(t.type)?"input":"blur";d.validateFocusLost&&t.addEventListener(n,(t=>validateForm({input:t.target}))),d.onfieldCondition&&(t.addEventListener("input",(t=>bit_conditionals(t))),observeElm(t,"value",((e,i)=>{e!==i&&bit_conditionals({target:t})})))})),d.onfieldCondition&&n.forEach((t=>{this.#C(t,"click",(e=>{setTimeout((()=>{bit_conditionals({target:t})&&e.stopPropagation()}))}))})),(this.#I("label",i)||[]).forEach((t=>{const i=t.getAttribute("for");t.setAttribute("for",`${i}-rpt-${e}`)})),this.#m){const t=this.#R(`.${this.#r}-rpt-add-btn`,i);t.dataset.index=e,this.#C(t,"click",(t=>this.#_(t)))}const r=this.#R(`.${this.#r}-rpt-rmv-btn`,i);return r.dataset.index=e,this.#C(r,"click",(t=>this.#O(t))),i}#D(t){const e=this.#s.getComputedStyle(t);let i=0;return i="border-box"===e.boxSizing?t.scrollHeight:parseInt(e.paddingTop)+parseInt(e.paddingBottom)+t.scrollHeight+parseInt(e.marginTop)+parseInt(e.marginBottom)+parseInt(e.borderTopWidth)+parseInt(e.borderBottomWidth),i}#W(t,e){let i=this.#D(t);setStyleProperty(t,"height",`${i}px`),e?(t.classList.remove("fld-hide"),i=this.#D(t),setStyleProperty(t,"height",`${i}px`)):(setTimeout((()=>{setStyleProperty(t,"height","0px")}),0),t.classList.add("fld-hide")),setTimeout((()=>{t.style.removeProperty("height"),e||t.remove()}),300)}#_(t){if(t.preventDefault(),this.#u>0&&this.#y.length>=this.#u)return;const{currentTarget:e}=t,i=e.dataset.index,s=e.closest(`.${this.#r}-rpt-wrp`),n=this.#E(this.#e),d=this.#T(n,this.#b);d.classList.add("fld-hide"),this.#F(this.#b,i),s.after(d),this.#W(d,!0),this.#N(this.#b),this.#B(this.#b),this.#k(),this.#g||scrollToElm(d),this.#b+=1}#O(t){if(t.preventDefault(),this.#c>=this.#y.length)return;const{currentTarget:e}=t,i=e.dataset.index,s=e.closest(`.${this.#r}-rpt-wrp`);this.#W(s,!1),this.#L(i),this.#K(i),this.#k(),s.previousElementSibling&&!this.#g&&scrollToElm(s.previousElementSibling)}#S(t){if(t.preventDefault(),this.#u>0&&this.#y.length>=this.#u)return;const e=this.#E(this.#e),i=this.#T(e,this.#b);i.classList.add("fld-hide"),this.#F(this.#b),this.#f.before(i),this.#W(i,!0),this.#N(this.#b),this.#B(this.#b),this.#k(),this.#b+=1}#F(t,e){if(e){const i=this.#y.indexOf(parseInt(e,10))+1;this.#y.splice(i,0,t)}else this.#y.push(t);this.#i.value=this.#y.join(",")}#L(t){const e=this.#y.indexOf(parseInt(t,10));this.#y.splice(e,1),this.#i.value=this.#y.join(",")}#k(){let t=!1;t=this.#u>0&&this.#y.length>=this.#u,this.#I(`.${this.#r}-rpt-add-btn`).forEach((e=>{e.disabled=t})),this.#w&&(this.#w.disabled=t),t=this.#c>0&&this.#y.length<=this.#c,this.#I(`.${this.#r}-rpt-rmv-btn`).forEach((e=>{e.disabled=t}))}reset(){let t=this.#y.length;if(t!==this.#l){for(this.#g=!0;t<this.#l;){const e=this.#y[this.#y.length-1],i=this.#R(`.${this.#r}-rpt-rmv-btn[data-index="${e}"]`);this.#_({currentTarget:i,preventDefault:()=>{}}),t+=1}for(;t>this.#l;){const e=this.#y[this.#y.length-1];this.#R(`.${this.#r}-rpt-rmv-btn[data-index="${e}"]`).click(),t-=1}this.#g=!1}}#R(t,e){return e?e.querySelector(t):this.#t.querySelector(t)}#I(t,e){return e?e.querySelectorAll(t):this.#t.querySelectorAll(t)}#E(t){return t.cloneNode(!0)}#C(t,e,i){t.addEventListener(e,i),this.#d.push({selector:t,eventType:e,cb:i}),this.value=0}#H(t){try{JSON.parse(t)}catch(t){return!1}return!0}get value(){return this.#i.value}set value(t){if(!t||!this.#H(t))return;const e=JSON.parse(t);if(!e.length)return;const i=e.length;let s=this.#y.length;if(s<i)for(;s<i;){const t=this.#y[this.#y.length-1],e=this.#R(`.${this.#r}-rpt-rmv-btn[data-index="${t}"]`);this.#_({currentTarget:e,preventDefault:()=>{}}),s+=1}const n=this.#s.bf_globals[this.#o],{fields:d}=n;e.forEach(((t,e)=>{const i=this.#y[e],s=this.#R(`.${this.#r}-rpt-wrp[data-index="${i}"]`);Object.entries(t).forEach((([t,e])=>{const r=d[t];if(!r||!e)return;const a=r.typ;let o=`${r.fieldName}[${i}]`;if(this.#A.includes(a)){const s=Array.isArray(e)?e.join(n?.configs?.bf_separator):e;n.inits[`${t}[${i}]`]?n.inits[`${t}[${i}]`].value=s:n.inits[t]&&(n.inits[t].value=s)}else if(["radio","check","image-select"].includes(a)){const i=Array.isArray(e)?e:e?.split(n?.configs?.bf_separator)||[];if(("check"===a||"image-select"===a&&"checkbox"===r.inpType)&&(o+="[]"),this.#I(`input[name="${o}"]`,s).forEach((t=>{if(i.includes(t.value)){t.checked=!0;const e=i.indexOf(t.value);i.splice(e,1)}})),i.length){const e=this.#R(`[data-oopt="${t}"]`,s);if(e){e.checked=!0;const n=this.#R(`.${t}-cw input[data-bf-other-inp]`,s);n&&(n.value=i.join(", "),e.value=i.join(", "),e.dispatchEvent(new Event("input")))}}}else if(e){const t=this.#R(`[name="${o}"]`,s);t&&(t.value=e)}}))}))}}}();
