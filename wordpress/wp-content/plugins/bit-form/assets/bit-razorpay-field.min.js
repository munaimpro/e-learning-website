var bit_razorpay_field=function(){"use strict";return class{#e=null;#t="";#n={clientId:"",options:{currency:"INR",amount:1,amountType:"fixed",theme:{},modal:{},prefill:{},notes:{}}};#i=[];#s=null;#r=null;#o=null;constructor(e,t){Object.assign(this.#n,t),this.#r=t.document||document,this.#o=t.window||window,this.#t=`#form-${this.#a()}`,this.#e="string"==typeof e?this.#r.querySelector(e):e,this.init()}init(){this.#c(this.#d(`.${this.#n.fieldKey}-razorpay-btn`),"click",(()=>{this.#l()}))}#d(e,t){return t?this.#r.querySelector(t).querySelector(e):this.#e.querySelector(e)}#c(e,t,n){e.addEventListener(t,n),this.#i.push({selector:e,eventType:t,cb:n})}#y(){this.#i.forEach((({selector:e,eventType:t,cb:n})=>{e.removeEventListener(t,n)}))}#m(e){if(e){const t=window.bf_globals[this.#a()].fields[e].fieldName;let n=this.#d(`[name="${t}"]`,this.#t);if(n&&"radio"===n.type&&(n=this.#d(`[name="${t}"]:checked`,this.#t)),n&&n.value)return n.value}return""}#p=e=>{const t=document.getElementById(`${this.#a()}`);t.classList.add("pos-rel","form-loading");const n=document.getElementById(`form-${this.#a()}`),i=this.#a()?.split("_")[1];if(null!=n){const s=bf_globals[this.#a()];this.#s&&(s.entryId=this.#s);let r=bfSelect(`input[name="${this.#n.fieldKey}"]`,n);r?r.value=e.razorpay_payment_id:setHiddenFld({name:this.#n.fieldKey,value:e.razorpay_payment_id,type:"text"},n);let o=bfSelect('button[type="submit"]',n);o||(o=document.createElement("button"),this.#h(o,"type","submit"),o.style.display="none",n.append(o)),o.click();const a={formID:i,fieldKey:this.#n.fieldKey,transactionID:e.razorpay_payment_id,payment_type:"subscription"===this.#n.payType?"subscription":"order",entry_id:this.#s},c=new URL(s?.ajaxURL);c.searchParams.append("_ajax_nonce",s?.nonce),c.searchParams.append("action","bitforms_save_razorpay_details"),fetch(c,{method:"POST",body:JSON.stringify(a)}).then((()=>{t.classList.remove("pos-rel","form-loading"),this.#s=null,r=bfSelect(`input[name="${this.#n.fieldKey}"]`,n),r&&(this.#h(r,"value",""),r.value="")}))}};async#u(e){const t=bf_globals[this.#a()],n=document.getElementById(`${this.#a()}`);n.classList.add("pos-rel","form-loading");const i=new URL(t?.ajaxURL);i.searchParams.append("_ajax_nonce",t?.nonce),i.searchParams.append("action","bitforms_create_razorpay_order");const s=await fetch(i,{method:"POST",body:JSON.stringify(e)}),r=await s.json();return n.classList.remove("pos-rel","form-loading"),r.data?.error||!r.success?"":r.data.id}async#l(){const{currency:e,amount:t,amountType:n,amountFld:i,name:s,description:r,theme:o,prefill:a,modal:c,notes:d}=this.#n.options,{confirm_close:l}=c,{contentId:y}=this.#n;let m=d;"undefined"!=typeof replaceFieldAndSmartValues&&m&&(m=JSON.parse(replaceFieldAndSmartValues(JSON.stringify(m),y))),"undefined"!=typeof bf_modify_razorpay_notes&&(m=bf_modify_razorpay_notes(m));const p=100*Number("dynamic"===n?this.#m(i):t);try{await isFormValidatedWithoutError(y)}catch(e){return!1}const h=await saveFormProgress(y),u=h?.[y];if(!u?.success)return;u.entry_id&&(this.#s=u.entry_id);let f="";if(this.#n.includeOrderId)if(this.#n.newOrderId||""===this.#n.orderIdFld){const t={payIntegID:this.#n.payIntegID,currency:e,amount:p,notes:m};f=await this.#u(t)}else f=this.#m(this.#n.orderIdFld);const g={key:this.#n.clientId,currency:e,amount:p,name:s,description:r,theme:o,order_id:f,prefill:{name:this.#m(a.prefillNameFld),email:this.#m(a.prefillEmailFld),contact:this.#m(a.prefillContactFld)},notes:m,modal:{backdropclose:!1,escape:!1,confirm_close:l},handler:async e=>this.#p(e)};new this.#o.Razorpay(g).open()}#a(){return this.#n.contentId}#h(e,t,n){e?.setAttribute?.(t,n)}destroy(){this.#y()}reset(){this.destroy(),this.init()}}}();
