import{a as z,j as r,a6 as Z,ba as W,u as q,ao as G,cK as J,r as N,g as w}from"./main-601.js";import{h as Q,B as E,e as L}from"./bf-409-72.js";import{S as A,M as P,B as T}from"./bf-548-69.js";function ee({clickAction:x,options:h,formFields:p}){const O=[{id:25,type:"back",content:r.jsx(E,{size:"18"})},{id:6,type:"operator",content:"("},{id:7,type:"operator",content:")"},{id:8,type:"empty",content:""},{id:9,type:"number",content:"7"},{id:10,type:"number",content:"8"},{id:11,type:"number",content:"9"},{id:12,type:"operator",content:"/"},{id:13,type:"number",content:"4"},{id:14,type:"number",content:"5"},{id:15,type:"number",content:"6"},{id:16,type:"operator",content:"*"},{id:17,type:"number",content:"1"},{id:18,type:"number",content:"2"},{id:19,type:"number",content:"3"},{id:20,type:"operator",content:"+"},{id:24,type:"clear",content:"AC"},{id:21,type:"number",content:"0"},{id:22,type:"number",content:"."},{id:23,type:"operator",content:"-"}],{css:i}=z();return r.jsxs("div",{className:i(j.board),children:[r.jsxs("div",{className:i(j.leftSlider),children:[h&&r.jsxs(r.Fragment,{children:[r.jsx("h4",{className:i({m:0,td:"underline",mt:5}),children:"Options"}),h.map((l,d)=>l.type==="group"?r.jsxs(r.Fragment,{children:[r.jsx("h4",{className:i({m:0}),children:l.title}),l.childs.map(u=>r.jsx("div",{role:"button",className:i(j.field,Z.ml1),onClick:()=>x(`${d+1}`,"option",{label:u.label,content:u.value},u.value.length),tabIndex:0,onKeyDown:void 0,children:u.label},`${u.value}${d+1}`))]}):r.jsx("div",{role:"button",className:i(j.field),onClick:()=>x(`${d+1}`,"option",{label:l.label,content:l.value},l.value.length),tabIndex:0,onKeyDown:void 0,children:l.label},`${l.value}${d+1}`)),r.jsx("div",{role:"button",className:i(j.field),onClick:()=>x(199,"field",{label:"Separator",content:"_bf_separator"}),tabIndex:0,onKeyDown:void 0,children:"Separator"})]}),r.jsx("h4",{className:i({m:0}),children:"Form Fields"}),p==null?void 0:p.map((l,d)=>r.jsx("div",{role:"button",className:i(j.field),onClick:()=>x(`${d+1}`,"field",{label:l.name,content:l.key}),tabIndex:0,onKeyDown:void 0,children:l.name},`field-${d}`)),r.jsx("h4",{className:i({m:0,td:"underline",mt:5}),children:"Smart Tags"}),A.map((l,d)=>r.jsx("div",{role:"button",className:i(j.field),onClick:()=>x(`${d+1}`,"field",{label:l.label,content:l.name,isFunction:l.custom}),tabIndex:0,onKeyDown:void 0,children:l.label},l.id))]}),r.jsxs("div",{className:i(j.keyContainer),children:[O.map(l=>r.jsx("div",{role:"button",className:`custom-button ${i(j.customButton)} ${l.type}`,onClick:()=>x(l.id,l.type,{content:l.content}),tabIndex:0,onKeyUp:void 0,children:l.content},l.id)),r.jsx("span",{role:"button",className:i(j.crossButton),onClick:()=>Q(),tabIndex:0,onKeyDown:void 0,children:r.jsx(W,{size:"12"})})]})]})}const j={board:{w:310,h:225,p:2,brs:5,dy:"flex",ta:"left"},leftSlider:{w:"40%",h:"100%",bc:"#F8F8F8",brs:8,cr:"#6A6A6A",dy:"flex",fd:"column",p:5,mr:5,ow:"overlay"},keyContainer:{w:"60%",h:"100%",bc:"white",dy:"flex",flxp:"wrap",pn:"relative"},h4:{fw:"500"},field:{fw:"400",fs:"12px !important",brs:"8px",padding:"5px",cur:"pointer",":hover":{bc:"#E5E5E5"}},customButton:{w:"45px",h:"45px",brs:"10px",br:"none",bc:"white",cr:"black",dy:"flex",ai:"center",jc:"center",cur:"pointer",fw:"600",fs:"18px",lh:"17px",":hover":{bc:"#F8F8F8"},"&.empty:hover":{bc:"white",cur:"default"}},crossButton:{pn:"absolute",w:"20px",h:"20px",brs:"50%",bc:"#F4F4F4",dy:"flex",jc:"center",ai:"center",cur:"pointer",rt:"-5px",tp:"-5px"}};function se({label:x,onChange:h,value:p,disabled:O,type:i,textarea:l,className:d,options:u,formFields:y}){const{css:g}=z(),_=q(G),K=J(_),[$,f]=N.useState(()=>B(p,K)),[a,b]=N.useState($.length),[D,S]=N.useState(!1),F=N.useRef(null),C=$.length>0,U=c=>{let n="",e=0,s=0;for(!D&&f(t=>t.filter(o=>(o==null?void 0:o.type)!=="caret")),$.map(t=>{t.type==="field"?t.dataObj.isFunction?(e+=1,n+=`\${${t.dataObj.content}`):n+=`\${${t.dataObj.content}}`:(n+=t.dataObj.content,e&&t.dataObj.content==="("&&(s+=1),e&&t.dataObj.content===")"&&(s-=1,s||(n+="}",e-=1)))});e--;)n+="}";h(n)},V=()=>{!D&&f(c=>w(c,n=>{n.splice(a,0,{id:0,type:"caret",dataObj:{content:""}})}))},H=c=>{const{key:n}=c,e=c.target.selectionEnd;b(e),C&&I({key:n})},I=c=>{const{key:n}=c;if(c.preventDefault&&c.preventDefault(),(n==="ArrowUp"||n==="Home")&&a>0)f(e=>{const s=e.filter(t=>t.type!=="caret");return s.unshift({id:0,type:"caret",dataObj:{content:""}}),s}),b(0);else if((n==="ArrowDown"||n==="End")&&a<$.length-1){const e=$.length-1;f(s=>{const t=s.filter(o=>o.type!=="caret");return t.push({id:0,type:"caret",dataObj:{content:""}}),t}),b(e)}else if(n==="ArrowLeft"&&a>0){const e=a-1;b(e),f(s=>w(s,t=>{[t[e],t[e+1]]=[t[e+1],t[e]]}))}else if(n==="ArrowRight"&&a<$.length-1){const e=a+1;b(e),f(s=>w(s,t=>{[t[e-1],t[e]]=[t[e],t[e-1]]}))}else n==="Backspace"?a>0&&(f(e=>e.slice(0,a-1).concat(e.slice(a))),b(e=>e-1)):n==="Delete"?a<$.length&&f(e=>e.slice(0,a+1).concat(e.slice(a+2))):/^\s{1}/.test(n)?(f(e=>w(e,s=>{s.splice(a,0,{type:"space",dataObj:{content:n}})})),b(e=>e+1)):!isNaN(n)||n==="."?(f(e=>w(e,s=>{s.splice(a,0,{type:"number",dataObj:{content:n}})})),b(e=>e+1)):"+-*/(),<>".indexOf(n)!==-1?(f(e=>w(e,s=>{s.splice(a,0,{type:"operator",dataObj:{content:n}})})),b(e=>e+1)):/^[!@#$%^&*()\\=,.?"':{}[\]|_<>]$/.test(n)?(f(e=>w(e,s=>{s.splice(a,0,{type:"symbol",dataObj:{content:n}})})),b(e=>e+1)):/^([A-Z]|[a-z]){1}\b/.test(n)&&(f(e=>w(e,s=>{s.splice(a,0,{type:"letters",dataObj:{content:n}})})),b(e=>e+1))};function k(c,n="before"){n==="straight"?a!==c&&(f(e=>{const s=e.filter(t=>t.type!=="caret");return s.splice(c,0,{id:0,type:"caret",dataObj:{content:""}}),s}),b(c)):n==="before"&&a!==c-1?(a<c&&(c-=1),f(e=>{const s=e.filter(t=>t.type!=="caret");return s.splice(c,0,{id:0,type:"caret",dataObj:{content:""}}),s}),b(c)):n==="after"&&a!==c+1&&(c+=1,a<c&&(c-=1),f(e=>{const s=e.filter(t=>t.type!=="caret");return s.splice(c,0,{id:0,type:"caret",dataObj:{content:""}}),s}),b(c))}const M=c=>{const n=c.target.selectionStart;b(n)},X=c=>{const n=c.pageX,e=c.pageY;if(c.target.classList.contains("calculator-field")){const s=c.target,t=s.children;if(s.children.length>1){let o=0;for(o=0;o<t.length;o+=1){const m=t[o].getBoundingClientRect();if(!(e>m.y+m.height)){if(n<m.x){k(o,"straight");break}else if(t[o+1]&&t[o+1].getBoundingClientRect().y>m.y+m.height){k(o+1,"straight");break}}}o===t.length&&k(o-1,"straight")}}else{const{target:s}=c,t=s.parentElement.children;for(let o=0;o<t.length;o+=1)if(t[o]===s){const m=s.getBoundingClientRect(),R=m.width/2;if(n>R+m.x){k(o,"after");break}else{k(o,"before");break}}}},Y=(c,n,e,s)=>{if(n==="clear"){f([]),b(0),h("");return}if($.length===0)if(n==="back"&&p)h(p.slice(0,a-1)+p.slice(a)),b(t=>t-(s||1));else if(n!=="field"&&n!=="back"){const t=p.slice(0,a)+e.content+p.slice(a);b(o=>o+(s||1)),h(t)}else{const t=`${p.slice(0,a)}\${${e.content}}${p.slice(a)}`,o=B(t,K);f(o),b(m=>m+(s||1))}else n==="back"?a>0&&(f(t=>t.slice(0,a-1).concat(t.slice(a))),b(t=>t-(s||1))):e.isFunction?(e.content=e.content.slice(0,e.content.indexOf("(")),f(t=>t.slice(0,a).concat([{id:c,type:n,dataObj:e},{id:c+1,type:"operator",dataObj:{content:"("}}],t.slice(a,a+1),[{id:c+2,type:"operator",dataObj:{content:")"}}],t.slice(a+1))),b(t=>t+(s||2))):(f(t=>t.slice(0,a).concat([{id:c,type:n,dataObj:e}],t.slice(a))),b(t=>t+(s||1)));setTimeout(()=>{var t;return(t=F.current)==null?void 0:t.focus()},0)};return r.jsxs("div",{className:g(v.wrp),children:[C&&r.jsx("div",{className:`${g(v.calculateField)} calculator-field`,role:"textbox",ref:F,onClick:X,onKeyDown:I,onFocus:V,onBlur:U,tabIndex:0,children:$.map((c,n)=>c&&r.jsxs("span",{className:`${g(v[c.type])} ${c.dataObj.isFunction?g(v.function):""}`,children:[c.dataObj.label||c.dataObj.content,c.type==="caret"&&r.jsx("span",{className:"caret"})]},`sp-${n}`))}),!C&&r.jsx(P,{label:x,type:i,disabled:O,onChange:c=>h(c.target.value),onKeyUp:H,onClick:M,value:p,textarea:l,className:`${d} cal-fld-inp`}),r.jsx(L,{trigger:"click",theme:"light",maxWidth:"520px",onShow:()=>{var c;S(!0),(c=F.current)==null||c.focus()},onHidden:()=>{S(!1),F.current!==document.activeElement&&f(c=>c.filter(n=>(n==null?void 0:n.type)!=="caret"))},p:"5px",distance:"400",interactive:!0,content:r.jsx(ee,{clickAction:Y,options:u,formFields:y}),children:r.jsx("span",{className:g(v.dotOpt),children:r.jsx(T,{size:"20"})})})]})}function B(x,h){const p=[];if(/\${\w[^ ${}]*}|^\(/g.test(x)){const O=x.match(/\${\w[^ ${}]*}|\d|\D/g);O==null||O.map((i,l)=>{if(/^\s{1}/g.test(i))p.push({id:l,type:"space",dataObj:{content:i}});else if(/^([A-Z]|[a-z]){1}\b/g.test(i))p.push({id:l,type:"letters",dataObj:{content:i}});else if(!isNaN(i)||i===".")p.push({id:l,type:"number",dataObj:{content:i}});else if(/^[+\-*/(),<>]{1}$/g.test(i))p.push({id:l,type:"operator",dataObj:{content:i}});else if(/^[!@#$%^&*()\\=,.?"':{}[\]|_<>]$/g.test(i))p.push({id:l,type:"symbol",dataObj:{content:i}});else if(/\${\w[^]*[\d\D\s]\)}/g.test(i)){let d=i.replace(/^\${|}$/g,"");const u=d.slice(d.indexOf("("));d=d.replace(/\([ \d\D]*\)/g,"()");const y=A.find(g=>g.name===d);d=d.replace(/\([ \d\D]*\)/g,""),p.push({id:l,type:"field",dataObj:{label:y==null?void 0:y.label,content:d,isFunction:!0}}),p.push(...B(u,h))}else if(/\${\w[^ ${}]*}/g.test(i)){const d=i.replace(/^\${|}$/g,""),u=h.find(y=>y.key===d);if(u)p.push({id:l,type:"field",dataObj:{label:u==null?void 0:u.name,content:u==null?void 0:u.key}});else{const y=A.find(g=>g.name===d);y?p.push({id:l,type:"field",dataObj:{label:y==null?void 0:y.label,content:y==null?void 0:y.name}}):p.push({id:l,type:"field",dataObj:{label:"Separator",content:i}})}}})}return p}const v={wrp:{w:"100%",mnh:38,h:"auto",lh:1.5,brs:8,dy:"flex",p:0,mt:5},calculateField:{w:"100%",h:"auto",p:5,ta:"left",b:"1px solid var(--gray-3)",brs:"8px 0px 0px 8px",dy:"flex",rg:"3px",ai:"center",jc:"left",flxp:"wrap",cur:"text",":focus-visible":{oe:"none"},":focus":{bcr:"var(--b-50)",bs:"0 0 0 2px var(--b-50) inset"}},dotOpt:{dy:"inline-flex",ai:"center",bc:"hsl(0deg 0% 85%)",p:5,b:"none",brs:"0px 8px 8px 0px",":hover":{bc:"hsl(0deg 0% 80%)"}},field:{p:"1px 7px",bc:"#E5E8FF",m:"0px 1px",dy:"flex",lh:"1.4",ai:"center",fs:"15px",jc:"center",brs:"8px"},option:{p:"1px 7px",bc:"#e6e6e6",m:"0px 1px",dy:"flex",lh:"1.4",ai:"center",fs:"15px",jc:"center",brs:"11px"},operator:{fs:"17px",fw:"600",p:"0px 1px"},space:{fs:"17px",fw:"600",p:"0px 3px"},function:{mr:"0px !important",brs:"8px 0px 0px 8px !important",bc:"hsl(233deg 100% 90%)"},caret:{dy:"inline-block",w:0,pn:"relative",h:"20px"}};export{se as C};
